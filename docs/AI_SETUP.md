# ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI –¥–ª—è PostgreSQL SQL Analyzer

## üìã –û–±–∑–æ—Ä

PostgreSQL SQL Analyzer –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–º–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤.

## üéØ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

### 1. **OpenAI** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–ú–æ–¥–µ–ª–∏**: gpt-4o-mini, gpt-4o, gpt-4-turbo, gpt-4, gpt-3.5-turbo
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –º–æ–¥–µ–ª—å**: `gpt-4o-mini` (–±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
- **API**: https://platform.openai.com/

### 2. **Anthropic**
- **–ú–æ–¥–µ–ª–∏**: claude-3-5-sonnet, claude-3-opus, claude-3-sonnet, claude-3-haiku
- **API**: https://console.anthropic.com/

### 3. **–õ–æ–∫–∞–ª—å–Ω—ã–µ LLM**
- **Ollama**: llama3.1, llama3, codellama, mistral, qwen
- **URL**: http://localhost:11434

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OpenAI

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://platform.openai.com/
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "API Keys"
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk-proj-`)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ .env —Ñ–∞–π–ª–µ
```bash
# OpenAI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SQL_ANALYZER_OPENAI_API_KEY=sk-proj-your-api-key-here
SQL_ANALYZER_OPENAI_MODEL=gpt-4o-mini
SQL_ANALYZER_OPENAI_TEMPERATURE=0.7
SQL_ANALYZER_ENABLE_AI_RECOMMENDATIONS=true
SQL_ANALYZER_AI_PROVIDER=openai
SQL_ANALYZER_AI_CONFIDENCE_THRESHOLD=0.7
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
–í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ Streamlit:
1. **–ü—Ä–æ–≤–∞–π–¥–µ—Ä AI**: –í—ã–±–µ—Ä–∏—Ç–µ "OpenAI"
2. **OpenAI API Key**: –í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á
3. **–ú–æ–¥–µ–ª—å OpenAI**: –í—ã–±–µ—Ä–∏—Ç–µ `gpt-4o-mini`
4. **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `0.7`

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Anthropic

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://console.anthropic.com/
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "API Keys"
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ .env —Ñ–∞–π–ª–µ
```bash
# Anthropic –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SQL_ANALYZER_ANTHROPIC_API_KEY=your-anthropic-key-here
SQL_ANALYZER_ANTHROPIC_MODEL=claude-3-5-sonnet-20240620
SQL_ANALYZER_ENABLE_AI_RECOMMENDATIONS=true
SQL_ANALYZER_AI_PROVIDER=anthropic
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
–í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ Streamlit:
1. **–ü—Ä–æ–≤–∞–π–¥–µ—Ä AI**: –í—ã–±–µ—Ä–∏—Ç–µ "Anthropic"
2. **Anthropic API Key**: –í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á
3. **–ú–æ–¥–µ–ª—å Anthropic**: –í—ã–±–µ—Ä–∏—Ç–µ `claude-3-5-sonnet-20240620`

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ LLM

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# –ó–∞–ø—É—Å–∫ Ollama
ollama serve

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏
ollama pull llama3.1:8b
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ .env —Ñ–∞–π–ª–µ
```bash
# –õ–æ–∫–∞–ª—å–Ω—ã–π LLM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SQL_ANALYZER_LOCAL_LLM_URL=http://localhost:11434
SQL_ANALYZER_LOCAL_LLM_MODEL=llama3.1:8b
SQL_ANALYZER_ENABLE_AI_RECOMMENDATIONS=true
SQL_ANALYZER_AI_PROVIDER=local
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
–í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ Streamlit:
1. **–ü—Ä–æ–≤–∞–π–¥–µ—Ä AI**: –í—ã–±–µ—Ä–∏—Ç–µ "–õ–æ–∫–∞–ª—å–Ω—ã–π LLM"
2. **URL –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ LLM**: `http://localhost:11434`
3. **–ú–æ–¥–µ–ª—å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ LLM**: –í—ã–±–µ—Ä–∏—Ç–µ `llama3.1:8b`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```bash
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å AI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
python -c "
from app.config import settings
from app.llm_integration import LLMIntegration

print('ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –Ω–∞—Å—Ç—Ä–æ–µ–∫')
print(f'OpenAI API Key: {settings.OPENAI_API_KEY[:20]}...' if settings.OPENAI_API_KEY else 'OpenAI API Key: –ù–ï –ó–ê–î–ê–ù')
print(f'OpenAI Model: {settings.OPENAI_MODEL}')
print(f'Enable AI: {settings.ENABLE_AI_RECOMMENDATIONS}')

try:
    llm = LLMIntegration({
        'openai_api_key': settings.OPENAI_API_KEY,
        'openai_model': settings.OPENAI_MODEL,
        'ai_provider': settings.AI_PROVIDER
    })
    print('‚úÖ AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç')
except Exception as e:
    print(f'‚ùå –û—à–∏–±–∫–∞ AI: {e}')
"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `./start_app.sh`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:8505
3. –í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ AI
4. –í–≤–µ–¥–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å –≤ –≤–∫–ª–∞–¥–∫–µ "–ê–Ω–∞–ª–∏–∑ SQL"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ AI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã AI

### –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (Temperature)
- **0.0**: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- **0.7**: –ë–∞–ª–∞–Ω—Å –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **1.0**: –ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- **2.0**: –û—á–µ–Ω—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

### –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (Confidence Threshold)
- **0.5**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- **0.7**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **0.9**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—á–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### OpenAI
- **gpt-4o-mini**: $0.15/1M —Ç–æ–∫–µ–Ω–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **gpt-4o**: $2.50/1M —Ç–æ–∫–µ–Ω–æ–≤
- **gpt-4-turbo**: $10/1M —Ç–æ–∫–µ–Ω–æ–≤
- **gpt-4**: $30/1M —Ç–æ–∫–µ–Ω–æ–≤

### Anthropic
- **claude-3-5-sonnet**: $3/1M —Ç–æ–∫–µ–Ω–æ–≤
- **claude-3-opus**: $15/1M —Ç–æ–∫–µ–Ω–æ–≤
- **claude-3-sonnet**: $3/1M —Ç–æ–∫–µ–Ω–æ–≤
- **claude-3-haiku**: $0.25/1M —Ç–æ–∫–µ–Ω–æ–≤

### –õ–æ–∫–∞–ª—å–Ω—ã–π LLM
- **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ** (—Ç—Ä–µ–±—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
1. **–ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ API –∫–ª—é—á–∏** –≤ Git
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞ API –∫–ª—é—á–µ–π** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ –¥–∞—à–±–æ—Ä–¥—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏**

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
```bash
# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI
export OPENAI_USAGE_LIMIT=1000  # $10 –≤ –º–µ—Å—è—Ü

# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
export AI_MAX_REQUESTS_PER_HOUR=100
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid API key"
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á
echo $SQL_ANALYZER_OPENAI_API_KEY

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞
# OpenAI: sk-proj-...
# Anthropic: sk-ant-...
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Rate limit exceeded"
```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
export AI_REQUEST_DELAY=2  # —Å–µ–∫—É–Ω–¥—ã

# –£–º–µ–Ω—å—à–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –¥–ª—è –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
export SQL_ANALYZER_OPENAI_TEMPERATURE=0.3
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection timeout"
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
ping api.openai.com

# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç
export AI_TIMEOUT=30  # —Å–µ–∫—É–Ω–¥—ã
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ gpt-4o-mini** –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞
2. **–ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–ª–∏–Ω—É –ø—Ä–æ–º–ø—Ç–æ–≤** –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏** –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
# –í–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ AI –æ—Ç–≤–µ—Ç–æ–≤
export AI_ENABLE_CACHE=true
export AI_CACHE_TTL=3600  # 1 —á–∞—Å
```

---

**üéâ AI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ—Ç–æ–≤—ã! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤.**
